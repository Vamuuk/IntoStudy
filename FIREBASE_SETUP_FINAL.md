# üî• Firebase Setup - –§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø v2.0

‚ö†Ô∏è **–≠–¢–û –ü–û–°–õ–ï–î–ù–Ø–Ø –ê–ö–¢–£–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø!** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞.

---

## üìã –®–∞–≥ 1: Security Rules (2 –º–∏–Ω—É—Ç—ã)

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å:
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://console.firebase.google.com/
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç: **into_study**
3. –°–ª–µ–≤–∞: **Firestore Database** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Rules**
4. **–£–¥–∞–ª–∏—Ç–µ –í–°–Å** —á—Ç–æ —Ç–∞–º –µ—Å—Ç—å
5. –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∏–∂–µ:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function auth() { return request.auth != null; }

    // Users - —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
    match /users/{uid} {
      allow read, write: if auth() && request.auth.uid == uid;
    }

    // Notes - –≤—Å–µ –≤–∏–¥—è—Ç –≤—Å–µ
    match /notes/{id} {
      allow read, write: if auth();
    }

    // Questions - –≤—Å–µ –≤–∏–¥—è—Ç –≤—Å–µ
    match /questions/{id} {
      allow read, write: if auth();
    }

    // Chats - –ø—É–±–ª–∏—á–Ω—ã–µ –≤–∏–¥—è—Ç –≤—Å–µ, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ç–æ–ª—å–∫–æ —á–ª–µ–Ω—ã
    match /chats/{id} {
      allow read: if auth() && (
        resource.data.isPublic == true ||
        request.auth.uid in resource.data.members
      );
      allow create: if auth();
      allow update, delete: if auth() && request.auth.uid in resource.data.members;

      // Messages - –≤–∏–¥—è—Ç –≤—Å–µ —á–ª–µ–Ω—ã —á–∞—Ç–∞ –∏–ª–∏ –≤—Å–µ –µ—Å–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π
      match /messages/{mid} {
        allow read: if auth() && (
          get(/databases/$(database)/documents/chats/$(id)).data.isPublic == true ||
          request.auth.uid in get(/databases/$(database)/documents/chats/$(id)).data.members
        );
        allow create: if auth();
        allow update, delete: if auth() && resource.data.senderUid == request.auth.uid;
      }
    }
  }
}
```

6. –ù–∞–∂–º–∏—Ç–µ **Publish** (—Å–∏–Ω—è—è –∫–Ω–æ–ø–∫–∞ —Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É)
7. **–ü–û–î–û–ñ–î–ò–¢–ï 60 –°–ï–ö–£–ù–î!**

---

## üìä –®–∞–≥ 2: –ò–Ω–¥–µ–∫—Å—ã (2 —Å–ø–æ—Å–æ–±–∞)

### –°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü—Ä–∏ –æ—à–∏–±–∫–µ `FAILED_PRECONDITION` —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. –ù–∞–∂–º–∏—Ç–µ **Create Index**
5. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2 –º–∏–Ω—É—Ç—ã

### –°–ø–æ—Å–æ–± 2: –í—Ä—É—á–Ω—É—é
1. **Firestore Database** ‚Üí **Indexes** ‚Üí **Create Index**
2. –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å:
   - Collection: `chats`
   - Field 1: `members` ‚Üí **Array**
   - Field 2: `lastMessageTime` ‚Üí **Descending**
   - Query scope: **Collection**
3. **Create**
4. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2 –º–∏–Ω—É—Ç—ã

---

## üöÄ –®–∞–≥ 3: –ó–∞–ø—É—Å–∫

```bash
# –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ –∑–∞–ø—É—â–µ–Ω–æ - –∑–∞–∫—Ä–æ–π—Ç–µ –µ–≥–æ
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ:
flutter run -d windows
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω—ã—Ö —á–∞—Ç–æ–≤ (–≤–∏–¥—è—Ç –≤—Å–µ)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ —á–ª–µ–Ω—ã)
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –≤ –ø—É–±–ª–∏—á–Ω—ã—Ö —á–∞—Ç–∞—Ö (—á–∏—Ç–∞—é—Ç –≤—Å–µ)
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–∞—Ö (—Ç–æ–ª—å–∫–æ —á–ª–µ–Ω—ã)
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞

---

## üîß –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ v2.0

**–ù–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- –ü—É–±–ª–∏—á–Ω—ã–µ —á–∞—Ç—ã –≤–∏–¥—è—Ç –í–°–ï –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —á–ª–µ–Ω—ã
- –°–æ–æ–±—â–µ–Ω–∏—è –Ω–∞—Å–ª–µ–¥—É—é—Ç –ø—Ä–∞–≤–∞ –æ—Ç —á–∞—Ç–∞
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞

**–°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –ù–ï –ê–ö–¢–£–ê–õ–¨–ù–´:**
- ‚ùå FIREBASE_RULES_SIMPLE.md
- ‚ùå FIX_PERMISSION_ERROR.md (—Å—Ç–∞—Ä—ã–µ –ø—Ä–∞–≤–∏–ª–∞)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¢–û–õ–¨–ö–û —ç—Ç–æ—Ç —Ñ–∞–π–ª!

---

## üìû –ü—Ä–æ–±–ª–µ–º—ã?

1. **permission-denied** ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã (Publish)
2. **failed-precondition** ‚Üí –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å (–®–∞–≥ 2)
3. **–ù–µ –≤–∏–¥–Ω—ã —á–∞—Ç—ã** ‚Üí –ü–æ–¥–æ–∂–¥–∏—Ç–µ 60 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ Publish

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-11-04**
**–í–µ—Ä—Å–∏—è: 2.0 FINAL**
